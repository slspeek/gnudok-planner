{% extends "base.html" %}
{% load bootstrap_toolkit %}
{% load i18n %}
{% block title %}{{ title }}{% endblock %}
{% block extra_head %}
{{ customerForm.media }}
{{ appointmentForm.media }}
<script src="{{ STATIC_URL }}appointment_manipulation.js"  > 
</script>
<script>
	"use strict";
	var set_data = function(data) {
		$('#region_label').text(data.region);
		$('#free_space').empty();
		for (var i = 0, len = data.dates.length; i < len; i++) {
			var date = data.dates[i];
			var calendar_id = date[0];
			var option;
			if ({{ calendar_id }} == calendar_id) {
				option = '<option selected="selected" value="' + calendar_id + '"> ' + date[1] + '</option>';
			} else {
				option = '<option value="' + calendar_id + '"> ' + date[1] + '</option>';
			}
			$('#id_free_space').append(option);
		}
	};
	var get_updates = function() {
	var postcode = get_normalized_postcode();
	var weight = $('#id_weight')[0].value
	if (postcode.length === 6) {
		$.getJSON('/main/get_available_dates/' + postcode + '/' + weight + '/{{ date_iso }}', set_data);
	}
};
	
</script>
{% endblock %}
{% block content %}
<h2>{{ title }}</h2>
<hr/>
<form id="appointment" name="appointment" action="" method="post" class="appointment">
	{% csrf_token %}
	<div style="dispaly:inline;" >
		<div class="span3">
			{{ customerForm|as_bootstrap }}

		</div>
		<div class="span4">
			{{ appointmentForm|as_bootstrap }}
			{{ hiddenForm }}
		</div>
		<div class="span4">
			<div>
				<h4>{% trans "Available dates for region:" %} <label id="region_label">{% trans "unknown" %}</label></h4>
				<select id="id_free_space" name="free_space" size=10 style="width: 100%;"></select>
			</div>
			<button class="btn btn-primary" type="submit">
				{% trans "Save" %}
			</button>
		</div>
	</div>
	<div id="status" class="info">

	</div>

</form>
{% endblock %}